% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/solve_in_situ.R
\name{solve_in_situ}
\alias{solve_in_situ}
\title{Configure and solve model in-situ}
\usage{
solve_in_situ(
  ...,
  model_input,
  closure_file,
  shock_file,
  n_tasks = 1L,
  n_subintervals = 1L,
  matrix_method = c("LU", "DBBD", "SBBD", "NDBBD"),
  solution_method = c("Johansen", "mod_midpoint"),
  steps = c(2L, 4L, 8L),
  laA = 300L,
  laD = 200L,
  laDi = 500L,
  terminal_run = FALSE,
  suppress_outputs = FALSE,
  n_timesteps = NULL,
  write_dir = tools::R_user_dir("teems", "cache"),
  writeout = FALSE
)
}
\arguments{
\item{...}{Named arguments corresponding to input files
necessary for an in-situ model run. Names must correspond to
"File" statements within the model Tablo file. Values
correspond to file paths where these files are found. No
checks or modifications are conducted on input files used in
this manner. All model declared input files as well as
\code{"model_file"}, \code{"closure_file"}, and \code{"shock_file"} are
required for in-situ model runs.}

\item{model_input}{Input containing the model. Character
vector of length 1, file name in working directory or path
to a .tab file. See
\href{https://github.com/teemsphere/teems-models}{teems-models}
for vetted model inputs and compatible Tablo file
formatting.}

\item{closure_file}{A character of length 1. File name in
working directory or path to a ".cls" closure file. See
\href{https://github.com/teemsphere/teems-models}{teems-models}
for formatting of closure files.}

\item{shock_file}{Character of length 1, file name in working
directory or path to a csv representing a user-provided
final shock file (default is \code{NULL}). No checks or
modifications will be conducted on this file.}

\item{n_tasks}{Integer length 1 (default is \code{1L}), number of
tasks to run in parallel. Must be \code{1L} if \code{"matrix_method"}
== "LU".}

\item{n_subintervals}{Integer length 1 (default is \code{1L}),
number of subintervals for the applied shock. More
subintervals may alleviate accuracy issues stemming from
large shock magnitudes.}

\item{matrix_method}{Character of length 1, matrix solution
method (default is \code{"LU"}). Choices:
\itemize{
\item \code{"LU"}: Standard LU decomposition, the most robust and
potentially slowest for a large model. \code{"n_tasks"} must be
\code{1L} if \code{"matrix_method"} == "LU". For use with both static
and dynamic models.
\item \code{"DBBD"}: Doubly bordered block diagonal, parallel solution
method for static models. Potentially faster than \code{"LU"}
although less robust.
\item \code{"SBBD"}: Singly bordered block diagonal, parallel solution
method for intertemporal models. Potentially faster than
\code{"LU"} although less robust.
\item \code{"NDBBD"}: Nested doubly bordered block diagonal, parallel
solution method for large intertemporal models with many
timesteps.
}}

\item{solution_method}{The solution method to be used, default
is the "one-step" \code{"Johansen"}. Choices:
\itemize{
\item \code{"Johansen"}: The Johansen method is fast however it should
only be used as a rough approximation due to handling of
nonlinear equations. See:
https://www.copsmodels.com/gpmanual.htm#gpd1.2.13
\item \code{"mod_midpoint"}: The modified midpoint method
performs multiple passes. See:
https://www.copsmodels.com/gpmanual.htm#gpd3.12.2
}}

\item{steps}{Integer length 3 (default is \code{c(2L, 4L, 8L)}). A
vector of steps for the modified midpoint method, must be all
odd or all even and length 3. Additional steps may improve
accuracy for some model runs.}

\item{laA}{Integer length 1 (default is \code{300L}). The laA memory
parameter for solver pertaining to matrix methods \code{"LU"} and
\code{"SBBD"}. Value is in percentages. Increase gradually if
prompted via "Error return from MA48B/BD because LA is ..."}

\item{laD}{Integer length 1 (default is \code{200L}). The laD memory
parameter for solver pertaining to matrix methods \code{"DBBD"}
and \code{"NDBBD"}. Value is in percentages. Increase gradually if
prompted via "Error return from MA48B/BD because LA is ..."}

\item{laDi}{Integer length 1 (default is \code{500L}). The laDi
memory parameter for solver pertaining to matrix method
\code{"NDBBD"}. Value is in percentages. Increase gradually if
prompted via "Error return from MA48B/BD because LA is ..."}

\item{terminal_run}{Logical length 1 (default is \code{FALSE}). When
\code{TRUE}, the function is exited without running the solver.
This allows the user to close any R IDE or other programs
prior to running from the terminal.}

\item{suppress_outputs}{Logical length 1 (default is \code{FALSE}).
When \code{TRUE} solver outputs are not automatically converted
into structured data with \code{\link[=ems_compose]{ems_compose()}}.}

\item{n_timesteps}{Integer length 1 (default is \code{NULL}). Number of timesteps must be manually entered if \code{"matrix_method"} is "NDBBD".}

\item{write_dir}{Character of length 1 (default is
\code{tools::R_user_dir("teems", "cache")}), base directory where
"teems" subdirectory will be created. Input files will be
written and model solution will be carried out within the
"teems" subdirectory. If persistence is desired, a
user-provided base directory must be provided.}

\item{writeout}{Logical length 1, default \code{FALSE}. Whether to
attempt to parse the Tablo file and append "Write"
declarations for out all model output coefficients and sets.
Note that if \code{TRUE} a successful writeout may require
modifications to the \code{"model_file"} provided. If \code{FALSE},
outputs will consist of model variables.}
}
\value{
A list of data.tables (if \code{"writeout"} == \code{FALSE}). A
tibble containing model output variables and coefficients (if
\code{"writeout"} == \code{TRUE}). Alternatively, if
\code{"suppress_outputs"} is \code{TRUE}, file path to a CMF file that
may be used with \code{\link[=ems_compose]{ems_compose()}}.
}
\description{
\code{solve_in_situ()} is a wrapper for the
\href{https://github.com/teemsphere/teems-solver}{teems-solver}
which conducts a minimal number of checks prior to attempting
to solve the constrained optimization problem according to a
range of runtime configuration options. In order to solve the
model, a \code{teems} Docker image
(\href{https://github.com/teemsphere/teems-solver}{teems-solver})
must be built. Singularity, accuracy, and error checks are
carried out following a successful run.

In contrast to \code{\link[=ems_solve]{ems_solve()}}, all model input files
must be provided by the user in their final form.
}
\seealso{
\code{\link[=ems_solve]{ems_solve()}} for the standard package-supported
solver.
}
